---
title: "What ML Sees in Crystal Graphs"
description: "How simple connectivity features relate to formation energy."
date: 2025-11-13
categories: [materials, graphs, interpretability]
---

> Can **topology alone** (without chemistry) tell us anything about formation energy?

Mostly all of the machine learning/ Deep learning algorithms used to predict materials properties like formation energy,
band gap are trained on same set of dataset. On every models the dataset overlaps. Mostly the difference in these models
are the way we extract features, mostly it combines atomic and geometric properties.
In this short experiment, I tried to convert
few structures (1000) from materials project datasets into **graphs**. These are the subset of data used to train **MEGNET** model. In this experiment atoms acts as node and edges are the constructed
between neighbors within 4 Å distance from the node. 

For example the graph structure for material with mp-1103373 (KSn2) looks like this:
![Graph connectivity for mp-1103373](../assets/graph_mp-1103373.png)!

 From each graph I extracted:

- `n_nodes`, `n_edges`
- `avg_degree`, `std_degree`
- `avg_clustering`, `density`

The extracted features heatmap shows how simple graph - based structural features relate to formation energy (eV/atom)
![Heatmap showing correlation between different graph features](../assets/clustering.png)!

Then I trained simple regressors (RandomForest, GradientBoosting, etc.) on these 6 features to predict formation energy per atom.

## Training simple RandomForestRegressor as an example

```{python}
from pathlib import Path
import joblib
import numpy as np
import pandas as pd
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_absolute_error, r2_score
from sklearn.model_selection import train_test_split

FEATURES_CSV = "../mp2019_graph_features.csv"
MODEL_PATH = "../rf_graph_energy_model.joblib"

def main():
    #load feature dataset
    df = pd.read_csv(FEATURES_CSV)
    feature_cols = [
        "n_nodes",
        "n_edges",
        "avg_degree",
        "std_degree",
        "avg_clustering",
        "density",
    ]

    X = df[feature_cols].values
    y = df["energy_pa"].values

    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.1, random_state=42
    )

    print(f"Training simple RandomForestRegressor")

    model = RandomForestRegressor(
        n_estimators=300,
        max_depth=None,
        random_state=42,
        n_jobs=-1,
    )
    model.fit(X_train, y_train)

    y_pred = model.predict(X_test)
    #get MAE
    mae = mean_absolute_error(y_test, y_pred)
    #Get R2
    r2 = r2_score(y_test, y_pred)

    print("\n Performance (graph features to formation energy):")
    print(f"  MAE: {mae:.4f} eV/atom")
    print(f"  R² : {r2:.4f}")

if __name__ == "__main__":
    main()
```
### simple Interpretation
- No chemical information included
- Only graph based features are used
- small amount of dataset is used for the experiment
- Without chemical information encoded the model cannot differentiate many important information such as metal vs semiconductor, 
ionic vs covalent bonding, oxidation states, bond strengths, etc., which plays major role in prediction task
- In this test example MAE of around 0.7 eV is completely expected and make sense
- R2 indicates that nearly 21% of the variance in formation energy is captured with topology only, somehow interesting

### **Conclusion**
- **Even without explicit **chemistry**, topology contains weak but real signals about stability. The fun begins when we add chemistry and **distance-weighted edges** — stay tuned.